<!DOCTYPE html>
<html lang="zh-tw">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
</head>
        <!--jquery-->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <!--時間處理插件-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
<script>
    function getList(dataset, datasetNumber, callback) {
        $.get("https://spreadsheets.google.com/feeds/list/" + dataset + "/" + datasetNumber + "/public/values?alt=json").then(function(data) { callback(data); });
    }

    var mainList = [];
    var productsObj = {};

    getList('1TM8EMwou-jLGQIhnlHtE7_rX50GV2rCbiLTSfkicoo0', '1', function(data) {
        getList('1TM8EMwou-jLGQIhnlHtE7_rX50GV2rCbiLTSfkicoo0', '2', function(productsObjData) {
            
            productsObj = JSON.parse(productsObjData.feed.entry[0].gsx$productsobj.$t);

            var d = data.feed.entry;
            for (var i in d) {
                if (d[i].gsx$timestamp.$t === '/') {
                    continue;
                }
                var row = {
                    'timestamp': new Date(d[i].gsx$timestamp.$t.replace(/-/g, '/')),
                    'orderNumber': d[i].gsx$ordernumber.$t,
                    'department': d[i].gsx$department.$t,
                    'grade': d[i].gsx$grade.$t,
                    'time': d[i].gsx$time.$t,
                    'total': parseInt(d[i].gsx$total.$t),
                    'order': JSON.parse(d[i].gsx$order.$t),
                }
                mainList.push(row);
            }

/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/

            var body = document.querySelector('body');
            var orderObj = {};
            var discountObj = {'total': {'discount': 0, 'count': 0}};
            var timeObj = {};
            var timeHourList = {};
            var collegeObj = {};
            var departmentObj = {};
            var gradeObj = {};

/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/

            var pTable = document.createElement('table');
                pTable.id = 'customers';
            var pTbody = document.createElement('tbody');

                pTbody.innerHTML += '<tr>' 
                + '<th>' + 'No.'
                + '</th><th>' + '月'
                + '</th><th>' + '日'
                + '</th><th>' + '時'
                + '</th><th>' + '訂單編號'
                + '</th><th>' + '系所'
                + '</th><th>' + '年級'
                + '</th><th>' + '取貨'
                + '</th><th>' + '折扣碼'
                + '</th><th>' + '金額'
                + '</th><th>' + '折扣'
                + '</th><th>' + '小計'
                + '</th><th>' + '折扣'
                + '</th><th class="colHighlight cost">' + '成本'
                + '</th><th class="colHighlight profit">' + '利潤'
                + '</th><th>' + '利益率'
                + '</th></tr>';

            var TPtotal = 0;
            var TPdiscount = 0;
            var TPsubtotal = 0;
            var TPcost = 0;
            var TPprofit = 0;

            var memberCount = 0;
            var discountCount = 0;

            for (var i = 0; i < mainList.length; i++) {
                var timestamp = mainList[i].timestamp;

                var year = moment(timestamp).format('YYYY');
                var month = moment(timestamp).format('MM');
                var day = moment(timestamp).format('DD');
                var hour = moment(timestamp).format('HH');

                var orderNumber = mainList[i].orderNumber;
                var department = mainList[i].department.substring(0, 3);
                var grade = mainList[i].grade.substring(0, 1);
                var time = new Date(mainList[i].time.split(' ')[0].replace(/-/g, '/'));
                var timeDay = parseInt(moment(time).format('DD'));
                var total = mainList[i].total;
                var order = mainList[i].order;

                var college = '';
                if (department == '102' 
                    || department == '152' 
                    || department == '157' 
                    || department == '171') {
                    college = 'edu'
                } else if (department == '203' 
                    || department == '253' 
                    || department == '260' 
                    || department == '263' 
                    || department == '861' 
                    || department == '862' 
                    || department == '863' ) {
                    college = 'dip'
                } else {
                    college = department.substring(0, 1);
                }

                var discount = mainList[i].order.totalDiscount + mainList[i].order.merchantDiscount;
                var coupon = mainList[i].order.coupon.substring(0, 3) || '無';

                var Psubtotal = 0;
                var Pcost = 0;
                var Pprofit = 0;

                discountObj.total.discount += order.totalDiscount;
                if (order.totalDiscount > 0) {
                    discountObj.total.count ++;
                }

                for (var m in order) {
                    if (typeof order[m] != 'object') {
                        continue;
                    }
                    if (!(m in orderObj)) {
                        orderObj[m] = {};
                    }
                    if (!(m in discountObj)) {
                        discountObj[m] = {};
                        discountObj[m].discount = order[m].discount;
                        discountObj[m].count = 0;
                    } else {
                        discountObj[m].discount += order[m].discount;
                    }
                    if (order[m].discount > 0) {
                        discountObj[m].count ++;
                    }
                    for (var p in order[m]) {
                        if (typeof order[m][p] != 'object') {
                            continue;
                        }
                        if (!(p in orderObj[m])) {
                            orderObj[m][p] = {
                                'quantity': 0,
                                'subtotal': 0,
                                'Q1': 0,
                                'T1': 0,
                                'C1': 0,
                                'Q2': 0,
                                'T2': 0,
                                'C2': 0
                            };
                        }
                        Psubtotal += order[m][p].subtotal;
                        Pcost += order[m][p].quantity * productsObj[m][p].cost;
                        orderObj[m][p].quantity += order[m][p].quantity;
                        orderObj[m][p].subtotal += order[m][p].subtotal;
                        if (timeDay == 13) {
                            orderObj[m][p].Q1 += order[m][p].quantity;
                            orderObj[m][p].T1 += order[m][p].subtotal;
                            orderObj[m][p].C1 += (order[m][p].quantity * productsObj[m][p].cost);
                        } else {
                            orderObj[m][p].Q2 += order[m][p].quantity;
                            orderObj[m][p].T2 += order[m][p].subtotal;
                            orderObj[m][p].C2 += (order[m][p].quantity * productsObj[m][p].cost);
                        }
                    }
                }

                Pprofit = Psubtotal - Pcost - discount;

                if (Pprofit == 0 && discount == 0 || total <= 0) {
                    memberCount++;
                }
                if (discount > 0) {
                    discountCount++;
                }

                pTbody.innerHTML += '<tr>'
                + '<td>' + (i+1)
                + '</td><td>' + month
                + '</td><td>' + day
                + '</td><td>' + hour 
                + '</td><td>' + orderNumber
                + '</td><td>' + department
                + '</td><td>' + grade
                + '</td><td>' + timeDay
                + '</td><td>' + coupon
                + '</td><td class="rightAlign">' + tC(total)
                + '</td><td class="rightAlign">' + tC(discount)
                + '</td><td class="rightAlign">' + tC(Psubtotal)
                + '</td><td class="rightAlign">' + tC(discount)
                + '</td><td class="rightAlign colHighlight cost">' + tC(Pcost)
                + '</td><td class="rightAlign colHighlight profit">' + tC(Pprofit)
                + '</td><td class="rightAlign">' + (Pprofit / total * 100).toFixed(1) + '%'
                + '</td></tr>';

                TPtotal += total
                TPdiscount += discount;
                TPsubtotal += Psubtotal;
                TPcost += Pcost;
                TPprofit += Pprofit;
/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/
                if (!(day in timeObj)) {
                    timeObj[day] = {};
                }
                for (var j = 0; j < 24; j++) {
                    if (!(j in timeObj[day])) {
                        timeObj[day][j] = {
                            'number': 0,
                            'total': 0,
                            'discount': 0,
                            'Psubtotal': 0,
                            'Pcost': 0,
                            'Pprofit': 0
                        };
                    }
                    if (!(j in timeHourList)) {
                        timeHourList[j] = {
                            'number': 0,
                            'total': 0,
                            'discount': 0,
                            'Psubtotal': 0,
                            'Pcost': 0,
                            'Pprofit': 0
                        };
                    }
                    if (hour == j) {
                        timeObj[day][j].number++;
                        timeObj[day][j].total += total;
                        timeObj[day][j].discount += discount;
                        timeObj[day][j].Psubtotal += Psubtotal;
                        timeObj[day][j].Pcost += Pcost;
                        timeObj[day][j].Pprofit += Pprofit;
/*******************************************************/
/*******************************************************/
/*******************************************************/
                        timeHourList[j].number++;
                        timeHourList[j].total += total;
                        timeHourList[j].discount += discount;
                        timeHourList[j].Psubtotal += Psubtotal;
                        timeHourList[j].Pcost += Pcost;
                        timeHourList[j].Pprofit += Pprofit;
                    }
                }
/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/
                if (!(department in departmentObj)) {
                    departmentObj[department] = {
                        'number': 0,
                        'total': 0,
                        'discount': 0,
                        'Psubtotal': 0,
                        'Pcost': 0,
                        'Pprofit': 0
                    };
                }
                departmentObj[department].number++;
                departmentObj[department].total += total;
                departmentObj[department].discount += discount;
                departmentObj[department].Psubtotal += Psubtotal;
                departmentObj[department].Pcost += Pcost;
                departmentObj[department].Pprofit += Pprofit;
/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/
                if (!(grade in gradeObj)) {
                    gradeObj[grade] = {
                        'number': 0,
                        'total': 0,
                        'discount': 0,
                        'Psubtotal': 0,
                        'Pcost': 0,
                        'Pprofit': 0
                    };
                }
                gradeObj[grade].number++;
                gradeObj[grade].total += total;
                gradeObj[grade].discount += discount;
                gradeObj[grade].Psubtotal += Psubtotal;
                gradeObj[grade].Pcost += Pcost;
                gradeObj[grade].Pprofit += Pprofit;
/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/
                if (!(college in collegeObj)) {
                    collegeObj[college] = {
                        'number': 0,
                        'total': 0,
                        'discount': 0,
                        'Psubtotal': 0,
                        'Pcost': 0,
                        'Pprofit': 0
                    };
                }
                collegeObj[college].number++;
                collegeObj[college].total += total;
                collegeObj[college].discount += discount;
                collegeObj[college].Psubtotal += Psubtotal;
                collegeObj[college].Pcost += Pcost;
                collegeObj[college].Pprofit += Pprofit;
/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/
            }
/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/

            pTbody.innerHTML += '<tr>'
            + '<td colspan="9">' + 'Summary'
            + '</td><td class="rightAlign">' + tC(TPtotal)
            + '</td><td class="rightAlign">' + tC(TPdiscount)
            + '</td><td class="rightAlign">' + tC(TPsubtotal)
            + '</td><td class="rightAlign">' + tC(TPdiscount)
            + '</td><td class="rightAlign colHighlight cost">' + tC(TPcost)
            + '</td><td class="rightAlign colHighlight profit">' + tC(TPprofit)
            + '</td><td class="rightAlign">' + (TPprofit / TPtotal * 100).toFixed(1) + '%'
            + '</td></tr>';

            pTbody.innerHTML += '<tr>'
            + '<td colspan="9">' + 'Average (With Member)'
            + '</td><td class="rightAlign">' + tC((TPtotal / (i+1)).toFixed(1))
            + '</td><td class="rightAlign">' + tC((TPdiscount / (i+1)).toFixed(1))
            + '</td><td class="rightAlign">' + tC((TPsubtotal / (i+1)).toFixed(1))
            + '</td><td class="rightAlign">' + tC((TPdiscount / (i+1)).toFixed(1))
            + '</td><td class="rightAlign colHighlight cost">' + tC((TPcost / (i+1)).toFixed(1))
            + '</td><td class="rightAlign colHighlight profit">' + tC((TPprofit / (i+1)).toFixed(1))
            + '</td><td class="rightAlign">' + ((TPprofit / (i+1)) / (TPtotal / (i+1)) * 100).toFixed(1) + '%'
            + '</td></tr>';

            pTbody.innerHTML += '<tr>'
            + '<td colspan="9">' + 'Without Member'
            + '</td><td class="rightAlign">' + ''
            + '</td><td class="rightAlign">' + ''
            + '</td><td class="rightAlign">' + ''
            + '</td><td class="rightAlign">' + ''
            + '</td><td class="rightAlign colHighlight cost">' + ''
            + '</td><td class="rightAlign colHighlight profit">' + tC((TPprofit / (i-memberCount+1)).toFixed(1))
            + '</td><td class="rightAlign">' + ''
            + '</td></tr>';

            pTable.appendChild(pTbody);
            body.appendChild(pTable);

/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/
/*******************************************************/

            var Tquantity = 0;
            var Tsubtotal = 0;
            var Tcost = 0;
            var Tprofit = 0;

            var TQ1 = 0;
            var TT1 = 0;
            var TC1 = 0;
            var TQ2 = 0;
            var TT2 = 0;
            var TC2 = 0;

            var table = document.createElement('table');
                table.id = 'prodcuts';
            for (var m in orderObj) {
                var Mquantity = 0;
                var Msubtotal = 0;
                var Mcost = 0;
                var Mprofit = 0;

                var MQ1 = 0;
                var MT1 = 0;
                var MC1 = 0;
                var MQ2 = 0;
                var MT2 = 0;
                var MC2 = 0;

                var tbody = document.createElement('tbody');
                    tbody.innerHTML += '<tr><th colspan=13>' + m + '</th></tr>';
                    var tr = document.createElement('tr');
                        tr.innerHTML += '<th>' + '廠商' + '</th>';
                        tr.innerHTML += '<th>' + '品名' + '</th>';
                        tr.innerHTML += '<th>' + '數量' + '</th>';
                        tr.innerHTML += '<th>' + '金額' + '</th>';
                        tr.innerHTML += '<th class="colHighlight cost">' + '成本' + '</th>';
                        tr.innerHTML += '<th class="colHighlight profit">' + '利潤' + '</th>';
                        tr.innerHTML += '<th>' + '品名' + '</th>';
                        tr.innerHTML += '<th>' + '數量 (D1)' + '</th>';
                        tr.innerHTML += '<th>' + '金額 (D1)' + '</th>';
                        tr.innerHTML += '<th class="colHighlight cost">' + '成本 (D1)' + '</th>';
                        tr.innerHTML += '<th>' + '數量 (D2)' + '</th>';
                        tr.innerHTML += '<th>' + '金額 (D2)' + '</th>';
                        tr.innerHTML += '<th class="colHighlight cost">' + '成本 (D2)' + '</th>';
                    tbody.appendChild(tr);

                for (var p in orderObj[m]) {
                    var tr = document.createElement('tr');
                        var merchant = m;
                        tr.innerHTML += '<td>' + m + '</td>';
                        var product = p;
                        tr.innerHTML += '<td>' + p + '</td>';
                        var quantity = orderObj[m][p].quantity;
                        Mquantity += quantity;
                        tr.innerHTML += '<td>' + quantity + '</td>';
                        var subtotal = orderObj[m][p].subtotal;
                        Msubtotal += subtotal;
                        tr.innerHTML += '<td class="rightAlign">' + tC(subtotal) + '</td>';
                        var cost = orderObj[m][p].quantity * productsObj[m][p].cost;
                        Mcost += cost;
                        tr.innerHTML += '<td class="rightAlign colHighlight cost">' + tC(cost) + '</td>';
                        var profit = subtotal - cost;
                        Mprofit += profit;
                        tr.innerHTML += '<td class="rightAlign colHighlight profit">' + tC(profit) + '</td>';

                        var product = p;
                        tr.innerHTML += '<td>' + p + '</td>';
                        var Q1 = orderObj[m][p].Q1;
                        MQ1 += Q1;
                        tr.innerHTML += '<td>' + Q1 + '</td>';
                        var T1 = orderObj[m][p].T1;
                        MT1 += T1;
                        tr.innerHTML += '<td class="rightAlign">' + tC(T1) + '</td>';
                        var C1 = orderObj[m][p].C1;
                        MC1 += C1;
                        tr.innerHTML += '<td class="rightAlign colHighlight cost">' + tC(C1) + '</td>';
                        var Q2 = orderObj[m][p].Q2;
                        MQ2 += Q2;
                        tr.innerHTML += '<td>' + Q2 + '</td>';
                        var T2 = orderObj[m][p].T2;
                        MT2 += T2;
                        tr.innerHTML += '<td class="rightAlign">' + tC(T2) + '</td>';
                        var C2 = orderObj[m][p].C2;
                        MC2 += C2;
                        tr.innerHTML += '<td class="rightAlign colHighlight cost">' + tC(C2) + '</td>';

                    tbody.appendChild(tr);
                }
                    var tr = document.createElement('tr');
                        var Mdiscount = discountObj[m].discount;
                        var MdiscountC = discountObj[m].count;
                        tr.innerHTML += '<td>' + m + '</td>';
                        tr.innerHTML += '<td>' + 'Discount' + '</td>';
                        tr.innerHTML += '<td>' + MdiscountC + '</td>';
                        tr.innerHTML += '<td class="rightAlign">' + tC(Mdiscount) + '</td>';
                        tr.innerHTML += '<td class="colHighlight cost">' + '' + '</td>';
                        tr.innerHTML += '<td class="colHighlight profit">' + '' + '</td>';
                        tr.innerHTML += '<td>' + 'Discount' + '</td>';
                        tr.innerHTML += '<td>' + '' + '</td>';
                        tr.innerHTML += '<td>' + '' + '</td>';
                        tr.innerHTML += '<td class="colHighlight cost">' + '' + '</td>';
                        tr.innerHTML += '<td>' + '' + '</td>';
                        tr.innerHTML += '<td>' + '' + '</td>';
                        tr.innerHTML += '<td class="colHighlight cost">' + '' + '</td>';
                    tbody.appendChild(tr);
                    var tr = document.createElement('tr');
                        tr.innerHTML += '<td>' + m + '</td>';
                        tr.innerHTML += '<td>' + 'Total' + '</td>';
                        tr.innerHTML += '<td>' + Mquantity + '</td>';
                        tr.innerHTML += '<td class="rightAlign">' + tC(Msubtotal) + '</td>';
                        tr.innerHTML += '<td class="rightAlign colHighlight cost">' + tC(Mcost) + '</td>';
                        tr.innerHTML += '<td class="rightAlign colHighlight profit">' + tC(Mprofit) + '</td>';
                        tr.innerHTML += '<td class="rightAlign">' + 'Total' + '</td>';
                        tr.innerHTML += '<td>' + MQ1 + '</td>';
                        tr.innerHTML += '<td class="rightAlign">' + tC(MT1) + '</td>';
                        tr.innerHTML += '<td class="rightAlign colHighlight cost">' + tC(MC1) + '</td>';
                        tr.innerHTML += '<td>' + MQ2 + '</td>';
                        tr.innerHTML += '<td class="rightAlign">' + tC(MT2) + '</td>';
                        tr.innerHTML += '<td class="rightAlign colHighlight cost">' + tC(MC2) + '</td>';
                    tbody.appendChild(tr);
                    Tquantity += Mquantity;
                    Tsubtotal += Msubtotal;
                    Tcost += Mcost;
                    Tprofit += Mprofit;
                    TQ1 += MQ1;
                    TT1 += MT1;
                    TC1 += MC1;
                    TQ2 += MQ2;
                    TT2 += MT2;
                    TC2 += MC2;
                table.appendChild(tbody);
            }
                var tbody = document.createElement('tbody');
                    tbody.innerHTML += '<tr><th colspan=13>' + 'Total' + '</th></tr>';
                    var tr = document.createElement('tr');
                        tr.innerHTML += '<th>' + '廠商' + '</th>';
                        tr.innerHTML += '<th>' + '品名' + '</th>';
                        tr.innerHTML += '<th>' + '數量' + '</th>';
                        tr.innerHTML += '<th>' + '金額' + '</th>';
                        tr.innerHTML += '<th class="colHighlight cost">' + '成本' + '</th>';
                        tr.innerHTML += '<th class="colHighlight profit">' + '利潤' + '</th>';
                        tr.innerHTML += '<th>' + '品名' + '</th>';
                        tr.innerHTML += '<th>' + '數量 (D1)' + '</th>';
                        tr.innerHTML += '<th>' + '金額 (D1)' + '</th>';
                        tr.innerHTML += '<th class="colHighlight cost">' + '成本 (D1)' + '</th>';
                        tr.innerHTML += '<th>' + '數量 (D2)' + '</th>';
                        tr.innerHTML += '<th>' + '金額 (D2)' + '</th>';
                        tr.innerHTML += '<th class="colHighlight cost">' + '成本 (D2)' + '</th>';
                    tbody.appendChild(tr);
                    var tr = document.createElement('tr');
                        var Tdiscount = discountObj.total.discount;
                        var TdiscountC = discountObj.total.count;
                        tr.innerHTML += '<td>' + 'Total' + '</td>';
                        tr.innerHTML += '<td>' + 'Discount' + '</td>';
                        tr.innerHTML += '<td>' + TdiscountC + '</td>';
                        tr.innerHTML += '<td class="rightAlign">' + tC(Tdiscount) + '</td>';
                        tr.innerHTML += '<td class="rightAlign colHighlight cost">' + '' + '</td>';
                        tr.innerHTML += '<td class="rightAlign colHighlight profit">' + '' + '</td>';
                        tr.innerHTML += '<td>' + 'Discount' + '</td>';
                        tr.innerHTML += '<td class="rightAlign">' + '' + '</td>';
                        tr.innerHTML += '<td class="rightAlign">' + '' + '</td>';
                        tr.innerHTML += '<td class="rightAlign colHighlight cost">' + '' + '</td>';
                        tr.innerHTML += '<td class="rightAlign">' + '' + '</td>';
                        tr.innerHTML += '<td class="rightAlign">' + '' + '</td>';
                        tr.innerHTML += '<td class="rightAlign colHighlight cost">' + '' + '</td>';
                    tbody.appendChild(tr);
                    var tr = document.createElement('tr');
                        tr.innerHTML += '<td>' + 'Total' + '</td>';
                        tr.innerHTML += '<td>' + 'Total' + '</td>';
                        tr.innerHTML += '<td>' + Tquantity + '</td>';
                        tr.innerHTML += '<td class="rightAlign">' + tC(Tsubtotal) + '</td>';
                        tr.innerHTML += '<td class="rightAlign colHighlight cost">' + tC(Tcost) + '</td>';
                        tr.innerHTML += '<td class="rightAlign colHighlight profit">' + tC(Tprofit) + '</td>';
                        tr.innerHTML += '<td>' + 'Total' + '</td>';
                        tr.innerHTML += '<td>' + TQ1 + '</td>';
                        tr.innerHTML += '<td class="rightAlign">' + tC(TT1) + '</td>';
                        tr.innerHTML += '<td class="rightAlign colHighlight cost">' + tC(TC1) + '</td>';
                        tr.innerHTML += '<td>' + TQ2 + '</td>';
                        tr.innerHTML += '<td class="rightAlign">' + tC(TT2) + '</td>';
                        tr.innerHTML += '<td class="rightAlign colHighlight cost">' + tC(TC2) + '</td>';
                    tbody.appendChild(tr);
                table.appendChild(tbody);
            body.appendChild(table);


            var timeTable = document.createElement('table');
                timeTable.id = 'time';

                var timeTbody = document.createElement('tbody');
                    timeTbody.innerHTML += '<tr>'
                    + '<th>' + '日' 
                    + '</th><th>' + '時' 
                    + '</th><th>' + '金額' 
                    + '</th><th>' + '小計'  
                    + '</th><th>' + '折扣'
                    + '</th><th class="colHighlight cost">' + '成本' 
                    + '</th><th class="colHighlight profit">' + '利潤'
                    + '</th></tr>';
                timeTable.appendChild(timeTbody);

                for (var d in timeObj) {
                    var Dtotal = 0;
                    var Ddiscount = 0;
                    var DPsubtotal = 0;
                    var DPcost = 0;
                    var DPprofit = 0;

                    var timeTbody = document.createElement('tbody');
                    for (var h in timeObj[d]) {

                        var total = timeObj[d][h].total;
                        var discount = timeObj[d][h].discount;
                        var Psubtotal = timeObj[d][h].Psubtotal;
                        var Pcost = timeObj[d][h].Pcost;
                        var Pprofit = timeObj[d][h].Pprofit;

                        timeTbody.innerHTML += '<tr>'
                        + '<td>' + d 
                        + '</td><td>' + h 
                        + '</td><td>' + tC(total) 
                        + '</td><td>' + tC(Psubtotal) 
                        + '</td><td>'  + tC(discount) 
                        + '</td><td class="colHighlight cost">'+ tC(Pcost) 
                        + '</td><td class="colHighlight profit">' + tC(Pprofit)
                        + '</td></tr>';
                        
                        Dtotal += total;
                        Ddiscount += discount;
                        DPsubtotal += Psubtotal;
                        DPcost += Pcost;
                        DPprofit += Pprofit;
                    }

                        timeTbody.innerHTML += '<tr>'
                        + '<td>' + d 
                        + '</td><td>' + 'total' 
                        + '</td><td>' + tC(Dtotal) 
                        + '</td><td>' + tC(DPsubtotal) 
                        + '</td><td>'  + tC(Ddiscount) 
                        + '</td><td class="colHighlight cost">'+ tC(DPcost) 
                        + '</td><td class="colHighlight profit">' + tC(DPprofit)
                        + '</td></tr>';

                timeTable.appendChild(timeTbody);
                }

                var DTimeHourtotal = 0;
                var DTimeHourPsubtotal = 0;
                var DTimeHourdiscount = 0;
                var DTimeHourPcost = 0;
                var DTimeHourPprofit = 0;

                var timeTbody = document.createElement('tbody');
                for (var h in timeHourList) {

                        var TimeHourtotal = timeHourList[h].total;
                        var TimeHourPsubtotal = timeHourList[h].Psubtotal;
                        var TimeHourdiscount = timeHourList[h].discount;
                        var TimeHourPcost = timeHourList[h].Pcost;
                        var TimeHourPprofit = timeHourList[h].Pprofit;

                        timeTbody.innerHTML += '<tr>' 
                        + '<td>' + '' 
                        + '</td><td>' + h
                        + '</td><td>' + tC(TimeHourtotal)
                        + '</td><td>' + tC(TimeHourPsubtotal)
                        + '</td><td>' + tC(TimeHourdiscount)
                        + '</td><td class="colHighlight cost">' + tC(TimeHourPcost)
                        + '</td><td class="colHighlight profit">' + tC(TimeHourPprofit)
                        + '</td></tr>';

                        DTimeHourtotal += TimeHourtotal;
                        DTimeHourPsubtotal += TimeHourPsubtotal;
                        DTimeHourdiscount += TimeHourdiscount;
                        DTimeHourPcost += TimeHourPcost;
                        DTimeHourPprofit += TimeHourPprofit;

                timeTable.appendChild(timeTbody);
                }

                var timeTbody = document.createElement('tbody');
                    timeTbody.innerHTML += '<tr>'
                    + '<td>' + '' 
                    + '</td><td>' + 'total'
                    + '</td><td>' + tC(DTimeHourtotal)
                    + '</td><td>' + tC(DTimeHourPsubtotal)
                    + '</td><td>' + tC(DTimeHourdiscount)
                    + '</td><td class="colHighlight cost">' + tC(DTimeHourPcost)
                    + '</td><td class="colHighlight profit">' + tC(DTimeHourPprofit)
                    + '</td></tr>';
                timeTable.appendChild(timeTbody);

            body.appendChild(timeTable);


            var acTable = document.createElement('table');
                acTable.id = 'department';

                var acTbody = document.createElement('tbody');
                    acTbody.innerHTML += '<tr><th>' + '系所' 
                    + '</th><th>' + '人次'  
                    + '</th><th>' + '金額' 
                    + '</th><th>' + '小計'  
                    + '</th><th>' + '折扣'
                    + '</th><th class="colHighlight cost">' + '成本' 
                    + '</th><th class="colHighlight profit">' + '利潤'
                    + '</th></tr>';
                acTable.appendChild(acTbody);

                var underACnumber = 0;
                var underACtotal = 0;
                var underACPsubtotal = 0;
                var underACdiscount = 0;
                var underACPcost = 0;
                var underACPprofit = 0;

                for (var i in departmentObj) {

                    var ACnumber = departmentObj[i].number;
                    var ACtotal = departmentObj[i].total;
                    var ACPsubtotal = departmentObj[i].Psubtotal;
                    var ACdiscount = departmentObj[i].discount;
                    var ACPcost = departmentObj[i].Pcost;
                    var ACPprofit = departmentObj[i].Pprofit;
                    acTbody.innerHTML += '<tr><td>' + i 
                    + '</td><td>' + ACnumber 
                    + '</td><td>' + tC(ACtotal) 
                    + '</td><td>' + tC(ACPsubtotal) 
                    + '</td><td>' + tC(ACdiscount)
                    + '</td><td class="colHighlight cost">' + tC(ACPcost) 
                    + '</td><td class="colHighlight profit">' + tC(ACPprofit)
                    + '</td></tr>';

                    if (i[1] == '0') {
                        underACnumber += ACnumber;
                        underACtotal += ACtotal;
                        underACPsubtotal += ACPsubtotal;
                        underACdiscount += ACdiscount;
                        underACPcost += ACPcost;
                        underACPprofit += ACPprofit;
                    }
                }
                acTable.appendChild(acTbody);

            body.appendChild(acTable);

            //

            var acTable = document.createElement('table');
                acTable.id = 'college';

                var acTbody = document.createElement('tbody');
                    acTbody.innerHTML += '<tr>' 
                    + '<th>' + '學院' 
                    + '</th><th>' + '人次'
                    + '</th><th>' + '金額'
                    + '</th><th>' + '小計'
                    + '</th><th>' + '折扣'
                    + '</th><th class="colHighlight cost">' + '成本'
                    + '</th><th class="colHighlight profit">' + '利潤'
                    + '</th></tr>';
                acTable.appendChild(acTbody);

                for (var i in collegeObj) {

                    var ACnumber = collegeObj[i].number;
                    var ACtotal = collegeObj[i].total;
                    var ACPsubtotal = collegeObj[i].Psubtotal;
                    var ACdiscount = collegeObj[i].discount;
                    var ACPcost = collegeObj[i].Pcost;
                    var ACPprofit = collegeObj[i].Pprofit;
                    acTbody.innerHTML += '<tr><td>' + i 
                    + '</td><td>' + ACnumber  
                    + '</td><td>' + tC(ACtotal) 
                    + '</td><td>' + tC(ACPsubtotal) 
                    + '</td><td>' + tC(ACdiscount)
                    + '</td><td class="colHighlight cost">' + tC(ACPcost) 
                    + '</td><td class="colHighlight profit">' + tC(ACPprofit)
                    + '</td></tr>';
                }
                acTable.appendChild(acTbody);

            body.appendChild(acTable);

            //

            var acTable = document.createElement('table');
                acTable.id = 'grade';

                var acTbody = document.createElement('tbody');
                    acTbody.innerHTML += '<tr><th>' + '年級' 
                    + '</th><th>' + '人次'
                    + '</th><th>' + '金額'
                    + '</th><th>' + '小計'
                    + '</th><th>' + '折扣'
                    + '</th><th class="colHighlight cost">' + '成本'
                    + '</th><th class="colHighlight profit">' + '利潤'
                    + '</th></tr>';
                acTable.appendChild(acTbody);

                for (var i in gradeObj) {

                    var ACnumber = gradeObj[i].number;
                    var ACtotal = gradeObj[i].total;
                    var ACPsubtotal = gradeObj[i].Psubtotal;
                    var ACdiscount = gradeObj[i].discount;
                    var ACPcost = gradeObj[i].Pcost;
                    var ACPprofit = gradeObj[i].Pprofit;
                    acTbody.innerHTML += '<tr><td>' + i 
                    + '</td><td>' + ACnumber  
                    + '</td><td>' + tC(ACtotal) 
                    + '</td><td>' + tC(ACPsubtotal) 
                    + '</td><td>' + tC(ACdiscount)
                    + '</td><td class="colHighlight cost">' + tC(ACPcost) 
                    + '</td><td class="colHighlight profit">' + tC(ACPprofit)
                    + '</td></tr>';
                }
                acTable.appendChild(acTbody);

                var acTbody = document.createElement('tbody');
                    acTbody.innerHTML += '<tr><td>' + '學士班'
                    + '</td><td>' + underACnumber 
                    + '</td><td>' + tC(underACtotal) 
                    + '</td><td>' + tC(underACPsubtotal) 
                    + '</td><td>' + tC(underACdiscount)
                    + '</td><td class="colHighlight cost">' + tC(underACPcost) 
                    + '</td><td class="colHighlight profit">' + tC(underACPprofit)
                    + '</td></tr>';
                acTable.appendChild(acTbody);

            body.appendChild(acTable);
/*
            document.querySelector('#customers').classList.add('hide');
            document.querySelector('#prodcuts').classList.add('hide');
            document.querySelector('#time').classList.add('hide');
            document.querySelector('#department').classList.add('hide');
            document.querySelector('#college').classList.add('hide');
            document.querySelector('#grade').classList.add('hide');
*/
            document.querySelector('button[name="customers"]').disabled = '';
            document.querySelector('button[name="prodcuts"]').disabled = '';
            document.querySelector('button[name="time"]').disabled = '';
            document.querySelector('button[name="department"]').disabled = '';
            document.querySelector('button[name="college"]').disabled = '';
            document.querySelector('button[name="grade"]').disabled = '';

        });
    });

    function tC(num){
        var parts = num.toString().split('.');
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        return '$' + parts.join('.');
    }

    $(function() {
        document.querySelector('button[name="customers"]').disabled = 'disabled';
        document.querySelector('button[name="prodcuts"]').disabled = 'disabled';
        document.querySelector('button[name="time"]').disabled = 'disabled';
        document.querySelector('button[name="department"]').disabled = 'disabled';
        document.querySelector('button[name="college"]').disabled = 'disabled';
        document.querySelector('button[name="grade"]').disabled = 'disabled';

        $('button[name="customers"]').on('click', function(ev){
            var tables = document.querySelectorAll('table');
            for (var i = 0; i < tables.length; i++) {
                tables[i].classList.add('hide');
            }
            document.querySelector('#customers').classList.remove('hide');
        });
        $('button[name="prodcuts"]').on('click', function(ev){
            var tables = document.querySelectorAll('table');
            for (var i = 0; i < tables.length; i++) {
                tables[i].classList.add('hide');
            }
            document.querySelector('#prodcuts').classList.remove('hide');
        });
        $('button[name="time"]').on('click', function(ev){
            var tables = document.querySelectorAll('table');
            for (var i = 0; i < tables.length; i++) {
                tables[i].classList.add('hide');
            }
            document.querySelector('#time').classList.remove('hide');
        });
        $('button[name="department"]').on('click', function(ev){
            var tables = document.querySelectorAll('table');
            for (var i = 0; i < tables.length; i++) {
                tables[i].classList.add('hide');
            }
            document.querySelector('#department').classList.remove('hide');
        });
        $('button[name="college"]').on('click', function(ev){
            var tables = document.querySelectorAll('table');
            for (var i = 0; i < tables.length; i++) {
                tables[i].classList.add('hide');
            }
            document.querySelector('#college').classList.remove('hide');
        });
        $('button[name="grade"]').on('click', function(ev){
            var tables = document.querySelectorAll('table');
            for (var i = 0; i < tables.length; i++) {
                tables[i].classList.add('hide');
            }
            document.querySelector('#grade').classList.remove('hide');
        });
    });

</script>
<style>
    * {
        box-sizing: border-box;
    }
    body {
        font-size: 0.5em;
    }
    table {
        border-collapse: collapse;
        width: 100%;
    }
    tbody, tr {
        width: 100%;
    }
    th, td {
        text-align: center;
        border: 1px #000 solid;
    }
    tr:hover {
        background-color: #FF9;
    }
    td:hover {
        background-color: #FF0;
    }
    .hide {
        display: none;
    }
    .rightAlign {
        text-align: right;
        border: 1px #000 solid;
    }
    .colHighlight.cost {
        background-color: #FF9;
    }
    .colHighlight.profit {
        background-color: #9F9;
    }
</style>
<body>
    <button type="button" name="customers">
        顧客
    </button>
    <button type="button" name="prodcuts">
        商品
    </button>
    <button type="button" name="time">
        分時
    </button>
    <button type="button" name="department">
        系所
    </button>
    <button type="button" name="college">
        學院
    </button>
    <button type="button" name="grade">
        年級
    </button>
</body>
</html>